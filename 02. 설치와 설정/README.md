# 02. 설치와 설정

## 2.1 MySQL 서버 설치

### 2.1.1 버전과 에디션 선택

- MySQL은 엔터프라이즈 에디션과 커뮤니티 에디션으로 나뉜다.
- 두 에디션의 핵심 기능은 동일하지만, 엔터프라이즈는 모니터링, 감사, 백업, 방화벽 등 고급 기능을 제공한다.
- 설치 시 가능한 한 최신 버전을 선택하는 것이 안정적이다.
- 퍼코나나 다른 업체가 제공하는 대체 서버와 도구도 존재하지만, MySQL 엔터프라이즈 기능을 대체하지는 못한다.

### 2.1.2 MySQL 설치 방식

운영체제에 따라 다양한 방식이 있으며, 대표 방식은 다음과 같다.

### 리눅스 Yum 인스톨러 설치

- 공식 리포지토리를 등록한 뒤 `yum` 명령으로 서버와 관련 패키지를 자동 설치한다.
- 검색 명령으로 설치 가능한 버전을 확인한 뒤 선택해 설치한다.
- RPM 패키지를 직접 다운로드해 설치하는 방식도 가능하다.

### macOS DMG 패키지 설치

- 다운로드한 DMG 파일을 실행해 설치한다.
- 설치 과정에서 인증 방식(Strong Password Encryption 또는 Legacy)을 선택한다.
- 설치 후 MySQL 관리 프로그램을 통해 서버 시작, 종료, 설정 변경을 할 수 있다.

### Windows MSI 인스톨러 설치

- MySQL Installer를 이용해 서버, 클라이언트 툴, Workbench 등을 함께 설치할 수 있다.
- 설치 유형(Developer / Server only / Custom) 선택이 가능하다.
- 포트, 인증 방식, 관리자 계정 생성 등 초기 설정을 마친 뒤 서버를 시작한다.

## 2.2 MySQL 서버의 시작과 종료

### 2.2.1 설정 파일 및 데이터 파일 준비

- 리눅스 환경에서는 `/etc/my.cnf` 파일이 초기 설정 파일이 된다.
- MySQL 서버를 처음 시작하기 전 초기화 명령으로 데이터 디렉터리를 생성해야 한다.
- `-initialize` 사용 시 임시 root 비밀번호가 생성된다.
- `-initialize-insecure` 사용 시 비밀번호 없이 root 계정이 생성된다.

### 2.2.2 서버 시작 및 종료

- systemd 환경에서는 `systemctl start mysqld`로 서버를 시작한다.
- `systemctl status mysqld`로 실행 상태를 확인한다.
- 종료는 `systemctl stop mysqld` 또는 MySQL 셸에서 `SHUTDOWN`을 사용한다.
- 정합성을 유지하려면 clean shutdown을 실행해 버퍼 내용을 디스크에 반영해야 한다.

### 2.2.3 서버 연결 테스트

- 로컬 소켓, TCP/IP, 원격 접속 등 다양한 방식으로 접속을 테스트한다.
- 설치 직후에는 `mysql -uroot -p` 또는 포트를 명시한 명령으로 접속한다.
- 서버가 정상적으로 응답하면 `SHOW DATABASES` 출력으로 확인할 수 있다.
- Telnet, Netcat 등을 사용해 포트 응답 여부만 빠르게 확인할 수도 있다.

## 2.3 MySQL 서버 업그레이드

### 2.3.1 인플레이스(서버 자체 업그레이드) 제약

- 메이저 버전 간 업그레이드는 데이터 파일 형식 차이 때문에 제약이 많다.
- MySQL 5.7에서 8.0으로의 업그레이드는 단순하지 않으며, 사전 점검이 필수다.
- MySQL 5.1 이하 버전은 순차 업그레이드를 거쳐야 한다.
- 데이터 파일 검증, 포맷 변경, DDL 처리 방식 차이 등이 모두 영향을 준다.

### 2.3.2 8.0 업그레이드 시 고려 사항

- 사용자 인증 방식이 개선됐으며 5.7과 호환되지 않을 수 있다.
- 외래키 처리 및 옵티마이저 동작 방식이 바뀌었다.
- GROUP BY 정렬 규칙, 파티션 테이블 형식 등이 변경됐다.
- 업그레이드 전 반드시 점검 스크립트(`mysqlcheck`, 외래키 검증 쿼리)를 수행해야 한다.

### 2.3.3 MySQL 8.0 업그레이드 절차

- MySQL 8.0에서는 ‘데이터 딕셔너리 업그레이드’와 ‘서버 업그레이드’가 별도로 진행된다.
- MySQL 8.0.16 이후에는 `mysql_upgrade` 도구가 사라졌고, 서버 실행 시 자동 업그레이드로 대체됐다.
- 업그레이드는 다음 순서로 진행된다.
    1. 서버 종료
    2. 기존 프로그램 제거
    3. 새 버전 설치
    4. 서버 시작 → 자동 업그레이드 수행
- 업그레이드 정책은 AUTO, NONE, MINIMAL, FORCE 등의 모드로 선택할 수 있다.

## 2.4 서버 설정

### 2.4.1 설정 파일 구조

- MySQL 설정 파일은 주로 `my.cnf` 또는 `my.ini`를 사용한다.
- 설정 파일은 여러 그룹 섹션을 가지며 각 프로그램이 해당 그룹을 읽어 사용한다.
- 섹션 예: `[mysqld_safe]`, `[mysqld]`, `[mysql]`, `[mysqldump]` 등.

### 2.4.2 시스템 변수

- MySQL은 매우 많은 시스템 변수를 제공하며 서버 성능과 기능을 제어한다.
- 변수에는 GLOBAL, SESSION, BOTH 타입이 있다.
- 변수는 정적(서버 재시작 필요)과 동적(즉시 변경 가능)으로 나뉜다.
- SHOW VARIABLES 또는 SHOW GLOBAL VARIABLES로 조회한다.

### 2.4.3 글로벌 변수와 세션 변수

- 글로벌 변수는 모든 클라이언트에 영향을 주며 MySQL 서버 차원의 동작을 정의한다.
- 세션 변수는 개별 연결마다 설정되며 서버 글로벌 설정을 기본값으로 상속받는다.
- 세션별 조정이 필요한 환경에서는 세션 변수를 활용한다.

### 2.4.4 정적 변수와 동적 변수

- 정적 변수는 설정 파일에 기록해야만 변경되며 서버 재시작이 필요하다.
- 동적 변수는 실시간 변경이 가능하며 `SET GLOBAL` 또는 `SET SESSION`으로 변경한다.
- 그러나 동적 변경은 설정 파일에 자동 반영되지 않으므로 재시작 후에도 유지하고 싶다면 설정 파일에 추가해야 한다.

### 2.4.5 SET PERSIST

- MySQL 8.0에서 추가된 기능으로, 변경된 시스템 변수를 **즉시 적용하면서 설정 파일에도 자동 반영**한다.
- 설정 파일에는 `mysqld-auto.cnf`로 저장된다.
- SET PERSIST ONLY는 값만 기록하고 즉시 반영하지 않는다.
- 사용자가 변경한 기록은 performance_schema에서 조회할 수 있다.

### 2.4.6 my.cnf 파일

- MySQL 8.0 서버에는 **약 570개 수준의 시스템 변수**가 존재하며, 실제 환경에서는 이보다 더 많아질 수도 있다.
- 모든 변수를 외울 필요는 없지만, MySQL을 제대로 운영하려면 어떤 변수들이 존재하고 어디에 영향을 주는지 이해해야 한다.
- 제공하는 예시는 저자가 실무에서 구축할 때 사용했던 설정이며, 모든 환경에 공통적으로 필요한 설정이 아니므로 그대로 복사하지 말고 환경에 맞게 조정해야 한다고 명시한다.
- 특히 하드웨어 성능이나 워크로드에 따라 부하가 매우 다르게 나타날 수 있으므로, **설정 하나가 시스템 성능을 크게 떨어뜨릴 수 있다는 점을 경계해야 한다.**
